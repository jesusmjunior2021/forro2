<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF--8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>FORRO</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <script src="https://mozilla.github.io/pdf.js/build/pdf.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    <script src='https://unpkg.com/maplibre-gl@3.6.2/dist/maplibre-gl.js'></script>
    <link href='https://unpkg.com/maplibre-gl@3.6.2/dist/maplibre-gl.css' rel='stylesheet' />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script>
      pdfjsLib.GlobalWorkerOptions.workerSrc = `https://mozilla.github.io/pdf.js/build/pdf.worker.js`;
    </script>
  <script type="importmap">
{
  "imports": {
    "react-dom/": "https://aistudiocdn.com/react-dom@^19.2.0/",
    "@google/genai": "https://aistudiocdn.com/@google/genai@^1.28.0",
    "react/": "https://aistudiocdn.com/react@^19.2.0/",
    "react": "https://aistudiocdn.com/react@^19.2.0",
    "three": "https://unpkg.com/three@0.158.0/build/three.module.js",
    "three/addons/": "https://unpkg.com/three@0.158.0/examples/jsm/",
    "three/": "https://aistudiocdn.com/three@^0.181.0/",
    "uuid": "https://aistudiocdn.com/uuid@^13.0.0",
    "react-dom": "https://aistudiocdn.com/react-dom@^19.2.0",
    "@vitejs/plugin-react": "https://aistudiocdn.com/@vitejs/plugin-react@^5.1.1",
    "vite": "https://aistudiocdn.com/vite@^7.2.2"
  }
}
</script>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
  
  :root {
    --color-bg-primary: #0D1117;
    --color-bg-secondary: #161B22;
    --color-bg-tertiary: #21262D;
    --color-border-primary: #30363D;
    --color-border-secondary: #484F58;
    --color-text-base: #E6EDF3;
    --color-text-muted: #8B949E;
    --color-text-dim: #6E7681;
    --color-accent-primary: #3081f7;
    --color-accent-secondary: #58a6ff;
    --color-accent-glow: rgba(48, 129, 247, 0.2);
    --color-user-bubble-bg: #1E40AF;
    --color-user-bubble-text: #DBEAFE;
    --color-system-bubble-bg: #374151;
    --color-system-bubble-text: #D1D5DB;
    --color-assistant-bubble-bg-start: #1a2331;
    --color-assistant-bubble-bg-end: #1F2937;
    --color-assistant-bubble-border: #4f46e5;
  }

  body[data-theme="cyan"] {
    --color-accent-primary: #0891b2;
    --color-accent-secondary: #22d3ee;
    --color-accent-glow: rgba(22, 163, 74, 0.4);
    --color-user-bubble-bg: #164e63;
    --color-user-bubble-text: #cffafe;
    --color-assistant-bubble-border: #0891b2;
  }

  body[data-theme="yellow"] {
    --color-accent-primary: #f59e0b;
    --color-accent-secondary: #facc15;
    --color-accent-glow: rgba(245, 158, 11, 0.4);
    --color-user-bubble-bg: #78350f;
    --color-user-bubble-text: #fef3c7;
    --color-assistant-bubble-border: #f59e0b;
  }

  body[data-theme="magenta"] {
    --color-accent-primary: #c026d3;
    --color-accent-secondary: #d946ef;
    --color-accent-glow: rgba(192, 38, 211, 0.4);
    --color-user-bubble-bg: #581c87;
    --color-user-bubble-text: #f3e8ff;
    --color-assistant-bubble-border: #c026d3;
  }

  body[data-theme="gray"] {
    --color-accent-primary: #a1a1aa;
    --color-accent-secondary: #d4d4d8;
    --color-accent-glow: rgba(161, 161, 170, 0.4);
    --color-user-bubble-bg: #404040;
    --color-user-bubble-text: #e5e5e5;
    --color-assistant-bubble-border: #a1a1aa;
  }
  
  body {
    font-family: 'Inter', sans-serif;
    background-color: var(--color-bg-primary);
    color: var(--color-text-base);
    font-size: 16px;
    line-height: 1.7;
  }

  body::before {
    content: '';
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    background: radial-gradient(ellipse at 20% 20%, var(--color-accent-glow), transparent 60%),
                radial-gradient(ellipse at 80% 80%, var(--color-accent-glow), transparent 60%);
    z-index: -1;
    pointer-events: none;
    opacity: 0.5;
  }

  .input-glow-border {
    border: 1px solid var(--color-border-primary);
    box-shadow: 0 0 0 0 var(--color-accent-glow);
    transition: box-shadow 0.3s ease-in-out, border-color 0.3s ease-in-out;
  }
  .input-glow-border:focus {
    border-color: var(--color-accent-primary);
    box-shadow: 0 0 15px 3px var(--color-accent-glow);
  }
  
  .line-clamp-2 {
    overflow: hidden;
    display: -webkit-box;
    -webkit-box-orient: vertical;
    -webkit-line-clamp: 2;
  }
  .line-clamp-3 {
      overflow: hidden;
      display: -webkit-box;
      -webkit-box-orient: vertical;
      -webkit-line-clamp: 3;
  }

  /* Custom Scrollbar Styles */
  ::-webkit-scrollbar {
    width: 10px;
  }

  ::-webkit-scrollbar-track {
    background: var(--color-bg-secondary);
  }

  ::-webkit-scrollbar-thumb {
    background-color: var(--color-border-primary);
    border-radius: 5px;
    border: 2px solid var(--color-bg-secondary);
  }

  ::-webkit-scrollbar-thumb:hover {
    background-color: var(--color-border-secondary);
  }
  
  * {
    scrollbar-width: thin;
    scrollbar-color: var(--color-border-primary) var(--color-bg-secondary);
  }
  
  /* General Layout & Panels */
  .slate-panel {
    position: fixed;
    top: 0;
    right: 0;
    height: 100%;
    background-color: var(--color-bg-secondary);
    border-left: 1px solid var(--color-border-primary);
    transform: translateX(100%);
    transition: transform 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
    z-index: 40;
    box-shadow: -10px 0 25px -5px rgba(0,0,0,0.5);
  }
  .slate-panel.open {
    transform: translateX(0);
  }

  /* REDESIGN: Transcription Display & Resource Panel Styles */
  .assistant-response-container { width: 100%; }
  .assistant-main-content {
      background: linear-gradient(135deg, var(--color-assistant-bubble-bg-start), var(--color-assistant-bubble-bg-end));
      border: 1px solid var(--color-border-primary);
      border-radius: 1.25rem;
      padding: 1.25rem 1.5rem;
      margin-bottom: 1rem;
      box-shadow: 0 10px 25px -5px rgba(0,0,0,0.3);
  }
  .resource-panel {
      padding: 0.5rem;
      background-color: var(--color-bg-secondary);
      border: 1px solid var(--color-border-primary);
      border-radius: 1rem;
  }
  .resource-panel-title {
      font-weight: 600;
      color: var(--color-text-muted);
      padding: 0.5rem 0.75rem;
      font-size: 0.875rem;
  }
  .resource-list {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 0.75rem;
  }
  .resource-item {
      background-color: var(--color-bg-tertiary);
      border-radius: 0.75rem;
      border: 1px solid var(--color-border-secondary);
      overflow: hidden;
      transition: transform 0.2s, box-shadow 0.2s;
  }
  .resource-item:hover {
      transform: translateY(-4px);
      box-shadow: 0 8px 20px rgba(0,0,0,0.3);
  }
  .resource-link { display: flex; flex-direction: column; height: 100%; }
  .resource-thumbnail {
      width: 100%;
      aspect-ratio: 16 / 9;
      object-fit: cover;
      background-color: var(--color-bg-secondary);
  }
  .resource-thumbnail-placeholder {
      width: 100%;
      aspect-ratio: 16/9;
      display: flex;
      align-items: center;
      justify-content: center;
      background-color: var(--color-bg-secondary);
  }
  .resource-info {
      padding: 0.75rem;
      flex-grow: 1;
      display: flex;
      flex-direction: column;
  }
  .resource-title {
      font-weight: 600;
      color: var(--color-text-base);
      line-height: 1.4;
      font-size: 0.875rem;
      margin-bottom: 0.25rem;
      cursor: pointer;
  }
  .resource-title:hover { color: var(--color-accent-secondary); }
  .resource-actions {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.5rem 0.75rem;
      background-color: rgba(0,0,0,0.2);
  }
  .resource-uri {
      font-size: 0.65rem; /* 10.4px */
      color: var(--color-text-dim);
      overflow: hidden;
      white-space: nowrap;
      text-overflow: ellipsis;
  }

  .tag-cluster-container { display: flex; align-items: center; gap: 0.375rem; flex-wrap: wrap; }
  .tag-pill {
      display: inline-flex;
      align-items: center;
      background-color: rgba(59, 130, 246, 0.15);
      color: var(--color-accent-secondary);
      padding: 0.25rem 0.6rem;
      border-radius: 9999px;
      font-size: 0.65rem;
      font-weight: 600;
      border: 1px solid rgba(59, 130, 246, 0.3);
  }
  .tag-more-btn, .tag-less-btn { cursor: pointer; background-color: var(--color-border-primary); color: var(--color-text-muted); }
  .tag-more-btn:hover, .tag-less-btn:hover { background-color: var(--color-border-secondary); color: var(--color-text-base); }


  /* Transcription Bubbles for Chat/Silent Mode */
  .transcription-bubble {
      padding: 1.15rem 1.4rem;
      border-radius: 1.25rem;
      max-width: 80%;
      word-wrap: break-word;
      font-size: 1.05rem;
      line-height: 1.7;
  }
  .transcription-bubble.user {
      background-color: var(--color-user-bubble-bg);
      color: var(--color-user-bubble-text);
      border-bottom-right-radius: 0.25rem;
  }
  .transcription-bubble.system {
      background-color: var(--color-system-bubble-bg);
      color: var(--color-system-bubble-text);
      border-bottom-left-radius: 0.25rem;
  }

  /* Splash Screen Animation */
  .splash-dot {
    width: 24px;
    height: 24px;
    background-color: #22d3ee; /* Cor ciano para o ponto */
    border-radius: 50%;
    box-shadow: 0 0 25px #22d3ee, 0 0 50px #22d3ee;
    animation: pulse-dot 2s infinite cubic-bezier(0.4, 0, 0.6, 1);
  }
  @keyframes pulse-dot {
    0%, 100% {
      transform: scale(1);
      opacity: 1;
    }
    50% {
      transform: scale(0.8);
      opacity: 0.7;
    }
  }

  /* Live Conversation View */
  .live-aura-orb { transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
  .state-connecting .live-aura-orb { transform: scale(1.05); box-shadow: 0 0 30px rgba(253, 224, 71, 0.5); }
  .state-connected .live-aura-orb, .state-speaking .live-aura-orb { transform: scale(1.1); box-shadow: 0 0 40px var(--color-accent-glow); }
  .state-speaking .live-aura-orb { animation: pulse-accent 1.5s infinite; }
  .state-thinking .outer-ring { animation: rotate 20s linear infinite, fade-in-out 3s ease-in-out infinite; }
  .state-thinking .inner-ring { animation: rotate 15s linear infinite reverse, fade-in-out 3s ease-in-out infinite 0.5s; }
  @keyframes pulse-accent { 0%, 100% { box-shadow: 0 0 40px var(--color-accent-glow); } 50% { box-shadow: 0 0 60px var(--color-primary); } }
  @keyframes fade-in-out { 0%, 100% { opacity: 0; } 50% { opacity: 1; } }
  @keyframes rotate { to { transform: rotate(360deg); } }

  /* Live View Drop Zone */
  .live-drop-zone {
    position: absolute;
    top: 60%;
    left: 0.5rem;
    right: 0.5rem;
    bottom: 0.5rem;
    z-index: 10;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-direction: column;
    transition: background-color 0.3s ease, border-color 0.3s ease;
    background-color: transparent;
    border: 4px dashed transparent;
    border-radius: 1rem;
    pointer-events: none; /* Initially, don't block underlying elements */
  }
  .live-drop-zone.active { /* When dragging over */
    background-color: var(--color-accent-glow);
    border-color: var(--color-accent-primary);
    pointer-events: all; /* Allow drop events */
  }
  .live-drop-zone.visible { /* Always visible but clickable */
      pointer-events: all;
      cursor: pointer;
  }
  .live-drop-zone.visible:hover:not(.active) {
      background-color: rgba(59, 130, 246, 0.05);
      border-color: rgba(59, 130, 246, 0.2);
  }

  .live-drop-zone-content {
    text-align: center;
    color: var(--color-text-muted);
    transition: opacity 0.3s ease, transform 0.3s ease;
    opacity: 0;
    transform: scale(0.95);
    pointer-events: none; /* Don't intercept clicks meant for the parent */
  }
  .live-drop-zone.active .live-drop-zone-content {
    opacity: 1;
    transform: scale(1);
    color: var(--color-text-base);
  }
  /* Show a subtle hint when just hovering */
  .live-drop-zone.visible:hover:not(.active) .live-drop-zone-content {
      opacity: 0.7;
      transform: scale(1);
  }

  /* File Context Chip */
  .file-context-chip {
    position: absolute;
    bottom: 1rem;
    left: 50%;
    transform: translateX(-50%);
    background-color: rgba(31, 41, 55, 0.8); /* gray-800/80 */
    backdrop-filter: blur(5px);
    border: 1px solid var(--color-border-secondary);
    border-radius: 9999px;
    padding: 0.5rem 1rem;
    display: flex;
    align-items: center;
    gap: 0.75rem;
    z-index: 20;
    box-shadow: 0 4px 15px rgba(0,0,0,0.4);
    max-width: 90%;
  }

  /* Information Card */
  .info-card {
      background-color: var(--color-bg-tertiary);
      border: 1px solid var(--color-border-secondary);
      backdrop-filter: blur(10px);
      box-shadow: 0 10px 20px rgba(0,0,0,0.3);
      animation: slide-in-from-right 0.5s cubic-bezier(0.25, 1, 0.5, 1);
  }
  @keyframes slide-in-from-right {
      from {
          opacity: 0;
          transform: translateX(100px);
      }
      to {
          opacity: 1;
          transform: translateX(0);
      }
  }
  .info-card-video-wrapper {
      position: relative;
      padding-bottom: 56.25%; /* 16:9 aspect ratio */
      height: 0;
      overflow: hidden;
  }
  .info-card-video-wrapper iframe {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
  }
  .info-card-thumbnail {
      background-size: cover;
      background-position: center;
  }

  /* Animations */
  @keyframes slide-in-up {
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
  }
  .animate-slide-in-up {
      animation: slide-in-up 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
  }
  
  @keyframes fade-in {
      from { opacity: 0; }
      to { opacity: 1; }
  }
  .animate-fade-in {
      animation: fade-in 0.3s ease-out;
  }
  .animate-pulse {
      animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
  }
  @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: .5; }
  }

  /* Document Editor */
  .document-editor-toolbar {
      display: flex;
      align-items: center;
      padding: 0.5rem;
      background-color: var(--color-bg-tertiary);
      border-bottom: 1px solid var(--color-border-primary);
      flex-shrink: 0;
  }
  .toolbar-btn {
      width: 2.25rem;
      height: 2.25rem;
      border-radius: 0.375rem;
      color: var(--color-text-muted);
      transition: background-color 0.2s, color 0.2s;
      display: inline-flex;
      align-items: center;
      justify-content: center;
  }
  .toolbar-btn:hover:not(:disabled) { background-color: var(--color-border-primary); color: white; }
  .toolbar-btn:disabled { color: var(--color-text-dim); cursor: not-allowed; }
  .toolbar-separator { width: 1px; height: 1.5rem; background-color: var(--color-border-primary); margin: 0 0.5rem; }
  .toolbar-select {
      background-color: var(--color-border-primary);
      border: 1px solid var(--color-border-secondary);
      color: var(--color-text-muted);
      border-radius: 0.375rem;
      padding: 0.25rem 0.5rem;
      font-size: 0.875rem;
      margin-right: 0.5rem;
  }
  .document-editor {
      position: relative;
      display: flex;
      height: 100%;
      width: 100%;
      background-color: var(--color-bg-secondary);
  }
  .line-numbers {
      padding: 1rem 0.5rem 1rem 1rem;
      font-size: 14px;
      font-family: monospace;
      color: var(--color-text-dim);
      text-align: right;
      user-select: none;
      background-color: var(--color-bg-tertiary);
      border-right: 1px solid var(--color-border-primary);
  }
  .editor-content-wrapper { position: relative; flex-grow: 1; height: 100%; }
  .editor-textarea, .editor-highlight-layer {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      padding: 1rem;
      line-height: 1.5;
      white-space: pre-wrap;
      word-wrap: break-word;
      border: none;
      outline: none;
      resize: none;
      overflow-y: auto;
  }
  .editor-textarea {
      background: transparent;
      color: var(--color-text-base);
      z-index: 2;
      caret-color: var(--color-accent-secondary);
  }
  .editor-highlight-layer {
      color: transparent;
      pointer-events: none;
      z-index: 1;
  }
  .editor-highlight-layer strong {
      font-weight: bold;
      color: var(--color-text-base);
      background-color: var(--color-bg-secondary);
  }
  .editor-highlight-layer em {
      font-style: italic;
      color: var(--color-text-base);
      background-color: var(--color-bg-secondary);
  }
  .error-underline {
      border-bottom: 2px dotted #F87171; /* red-400 */
      position: relative;
      cursor: help;
  }
  .error-underline:hover::after {
      content: attr(data-suggestion);
      position: absolute;
      bottom: 100%;
      left: 50%;
      transform: translateX(-50%);
      background-color: var(--color-bg-secondary);
      color: #FBBF24; /* amber-400 */
      padding: 0.5rem;
      border-radius: 0.375rem;
      font-size: 0.75rem;
      white-space: nowrap;
      z-index: 10;
      border: 1px solid var(--color-border-primary);
  }
  .modified-text {
    color: #F87171; /* red-400 */
    background-color: rgba(248, 113, 113, 0.1);
    border-radius: 2px;
  }

  /* Editor Context Menu & Popovers */
  .context-menu {
      position: fixed;
      z-index: 1000;
      background-color: var(--color-bg-tertiary);
      border: 1px solid var(--color-border-primary);
      border-radius: 0.5rem;
      padding: 0.5rem;
      box-shadow: 0 5px 15px rgba(0,0,0,0.4);
      min-width: 180px;
  }
  .context-menu-item {
      display: flex;
      align-items: center;
      width: 100%;
      padding: 0.5rem 0.75rem;
      font-size: 0.875rem;
      color: var(--color-text-muted);
      border-radius: 0.25rem;
      transition: background-color 0.2s, color 0.2s;
  }
  .context-menu-item:hover {
      background-color: var(--color-accent-primary);
      color: white;
  }
  .suggestion-popover {
      position: fixed;
      z-index: 1000;
      background-color: var(--color-bg-secondary);
      border: 1px solid var(--color-accent-primary);
      border-radius: 0.5rem;
      padding: 1rem;
      box-shadow: 0 10px 25px rgba(0,0,0,0.5);
      width: 100%;
      max-width: 400px;
      animation: fade-in 0.2s ease-out;
  }
  .suggestion-popover .popover-title {
      font-weight: bold;
      color: var(--color-accent-secondary);
      margin-bottom: 0.75rem;
  }
  .suggestion-popover .popover-content {
      background-color: var(--color-bg-tertiary);
      border-radius: 0.25rem;
      padding: 0.75rem;
      font-size: 0.875rem;
      max-height: 200px;
      overflow-y: auto;
      border: 1px solid var(--color-border-primary);
  }


  /* Comparison View */
  .comparison-view {
      display: flex;
      height: 100%;
      width: 100%;
  }
  .comparison-pane {
      flex: 1;
      width: 50%;
      overflow-y: auto;
      padding: 1rem;
      position: relative;
  }
  .comparison-pane:first-child { border-right: 1px solid var(--color-border-primary); }
  .improvement-block {
      padding: 1rem;
      margin-bottom: 1rem;
      border: 1px solid var(--color-border-secondary);
      border-radius: 0.5rem;
      transition: background-color 0.2s;
  }
  .improvement-block .reason {
      font-size: 0.75rem;
      font-style: italic;
      color: #FBBF24; /* amber-400 */
      margin-bottom: 0.5rem;
      border-bottom: 1px solid var(--color-border-primary);
      padding-bottom: 0.5rem;
  }
  .improvement-block .original-text {
      text-decoration: line-through;
      color: var(--color-text-muted);
      white-space: pre-wrap;
      word-wrap: break-word;
      font-family: monospace;
      font-size: 0.875rem;
      line-height: 1.5;
  }
  .improvement-block .improved-text {
      color: #A78BFA; /* violet-400 */
      white-space: pre-wrap;
      word-wrap: break-word;
      font-family: monospace;
      font-size: 0.875rem;
      line-height: 1.5;
  }

  /* Editor Chat */
  .document-editor {
      display: flex;
      overflow: hidden;
  }
  .editor-chat-panel {
      width: 320px;
      flex-shrink: 0;
      border-left: 1px solid var(--color-border-primary);
      display: flex;
      flex-direction: column;
      background-color: var(--color-bg-tertiary);
  }
  .editor-chat-specialization {
      padding: 0.5rem;
      border-bottom: 1px solid var(--color-border-primary);
  }
  .specialization-input {
      width: 100%;
      background: var(--color-bg-secondary);
      border: 1px solid var(--color-border-secondary);
      color: var(--color-text-muted);
      border-radius: 0.375rem;
      font-size: 0.75rem;
      padding: 0.5rem 0.5rem 0.5rem 2rem;
  }
  .editor-chat-history {
      flex-grow: 1;
      overflow-y: auto;
      padding: 0.75rem;
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
  }
  .editor-chat-message, .editor-chat-card {
      padding: 0.75rem;
      border-radius: 0.5rem;
      font-size: 0.875rem;
      max-width: 95%;
  }
  .editor-chat-message.user {
      background-color: var(--color-user-bubble-bg);
      color: var(--color-user-bubble-text);
      align-self: flex-end;
  }
  .editor-chat-message.assistant {
      background-color: var(--color-system-bubble-bg);
      color: var(--color-system-bubble-text);
      align-self: flex-start;
  }
  .editor-chat-card {
      background-color: #3730A3; /* indigo-800 */
      border: 1px solid #4F46E5; /* indigo-600 */
      align-self: flex-start;
      width: 100%;
  }
  .editor-chat-card .card-title {
      font-weight: bold;
      color: #C7D2FE; /* indigo-200 */
  }
  .editor-chat-card .card-explanation {
      font-size: 0.75rem;
      color: #A5B4FC; /* indigo-300 */
      margin-top: 0.25rem;
      margin-bottom: 0.75rem;
      border-bottom: 1px solid #4338CA;
      padding-bottom: 0.5rem;
  }
  .editor-chat-card .card-content {
      background-color: var(--color-bg-secondary);
      padding: 0.5rem;
      border-radius: 0.25rem;
      font-family: monospace;
      font-size: 0.75rem;
      max-height: 150px;
      overflow: auto;
      white-space: pre-wrap;
      word-wrap: break-word;
  }
   .editor-chat-card .card-action-btn, .suggestion-popover .card-action-btn {
      padding: 0.375rem 0.75rem;
      font-size: 0.75rem;
      font-weight: 600;
      border-radius: 0.375rem;
      transition: background-color 0.2s;
      display: inline-flex;
      align-items: center;
      gap: 0.375rem;
   }
   .card-action-btn.approve { background-color: #166534; color: #dcfce7; }
   .card-action-btn.approve:hover { background-color: #15803d; }
   .card-action-btn.reject { background-color: #991b1b; color: #fee2e2; }
   .card-action-btn.reject:hover { background-color: #b91c1c; }

  /* Document Library */
  .document-library-item { position: relative; }
  .document-library-item .delete-btn {
      position: absolute;
      top: 50%;
      right: 0.75rem;
      transform: translateY(-50%);
      opacity: 0;
      transition: opacity 0.2s;
  }
  .document-library-item:hover .delete-btn { opacity: 1; }

  /* Knowledge Tree */
  .knowledge-tree-resource-item {
      display: flex;
      align-items: center;
      padding: 0.5rem;
      border-radius: 0.5rem;
      transition: background-color 0.2s;
  }
  .knowledge-tree-resource-item:hover {
      background-color: var(--color-border-primary);
  }

  /* Knowledge Map */
  .knowledge-map-svg { cursor: grab; }
  .knowledge-map-svg:active { cursor: grabbing; }
  .map-edge {
      stroke: var(--color-border-secondary);
      stroke-width: 1.5;
  }
  .map-node-group {
      cursor: pointer;
      text-align: center;
  }
  .map-node-shape {
      stroke-width: 3;
      transition: all 0.2s;
  }
  .map-node-center { fill: #1E3A8A; stroke: var(--color-accent-primary); }
  .map-node-topic { fill: var(--color-bg-tertiary); stroke: var(--color-accent-secondary); }
  .map-node-resource { fill: var(--color-border-primary); stroke: var(--color-text-muted); }
  .map-node-group:hover .map-node-shape {
      filter: drop-shadow(0px 0px 8px currentColor);
      stroke-width: 4;
  }
  .map-text {
      font-size: 10px;
      fill: var(--color-text-muted);
      text-anchor: middle;
      pointer-events: none;
      user-select: none;
  }
  .map-node-icon {
      font-size: 14px;
      color: var(--color-accent-secondary);
      pointer-events: none;
  }
  .map-expand-button { fill: var(--color-bg-secondary); stroke: var(--color-accent-secondary); cursor: pointer; }
  .map-expand-icon { font-size: 10px; color: var(--color-accent-secondary); }
  .knowledge-map-search {
      position: absolute;
      top: 1rem;
      left: 1rem;
      z-index: 10;
  }
  .knowledge-map-search input {
      width: 250px;
      background-color: var(--color-bg-tertiary);
      border: 1px solid var(--color-border-secondary);
      color: var(--color-text-muted);
      border-radius: 0.5rem;
      padding: 0.5rem 1rem 0.5rem 2.5rem;
      font-size: 0.875rem;
  }
  .knowledge-map-search .search-icon {
      position: absolute;
      top: 50%;
      left: 1rem;
      transform: translateY(-50%);
      color: var(--color-text-dim);
  }
  .knowledge-map-tooltip {
    position: fixed;
    background-color: var(--color-bg-tertiary);
    border: 1px solid var(--color-border-primary);
    padding: 0.5rem 1rem;
    border-radius: 0.5rem;
    pointer-events: none;
    z-index: 100;
    font-size: 0.875rem;
    box-shadow: 0 4px 15px rgba(0,0,0,0.3);
    max-width: 250px;
  }
  .knowledge-map-tooltip h4 { font-weight: bold; color: var(--color-text-base); }
  .knowledge-map-tooltip p { color: var(--color-text-muted); font-size: 0.75rem; }
  
  /* REDESIGN: New Footer Styles */
  .unified-footer {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    padding: 1rem 1rem 0.5rem 1rem;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.75rem;
    z-index: 20;
    background: linear-gradient(to top, rgba(13, 17, 23, 0.95) 30%, rgba(13, 17, 23, 0.7) 70%, transparent 100%);
  }

  .footer-input-bar {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    width: 100%;
    max-width: 800px;
    background-color: var(--color-bg-tertiary);
    border: 1px solid var(--color-border-primary);
    border-radius: 1.5rem; /* 24px */
    padding: 0.5rem;
    box-shadow: 0 4px 15px rgba(0,0,0,0.4);
    transition: box-shadow 0.3s, border-color 0.3s;
  }

  .footer-input-bar:focus-within {
    border-color: var(--color-accent-primary);
    box-shadow: 0 0 15px 3px var(--color-accent-glow);
  }

  .footer-input-bar textarea {
    flex-grow: 1;
    background: transparent;
    border: none;
    outline: none;
    resize: none;
    color: var(--color-text-base);
    font-size: 1rem;
    padding: 0.5rem;
    max-height: 120px;
  }
  
  .footer-action-btn {
    width: 2.5rem; /* 40px */
    height: 2.5rem;
    border-radius: 50%;
    flex-shrink: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: background-color 0.2s, color 0.2s;
  }
  .footer-action-btn.secondary {
    background-color: var(--color-bg-secondary);
    color: var(--color-text-muted);
  }
   .footer-action-btn.secondary:hover:not(:disabled) {
    background-color: var(--color-border-primary);
    color: white;
  }
  .footer-action-btn.primary {
    background-color: var(--color-accent-primary);
    color: white;
  }
  .footer-action-btn.primary:hover:not(:disabled) {
     background-color: var(--color-accent-secondary);
  }
   .footer-action-btn:disabled {
    background-color: var(--color-border-primary);
    color: var(--color-text-dim);
    cursor: not-allowed;
  }

  .footer-bottom-bar {
    display: flex;
    justify-content: space-between;
    align-items: center;
    width: 100%;
    max-width: 900px;
    padding: 0 1rem;
    position: relative;
    height: 4rem; /* 64px */
  }
  
  .central-mic-button {
    position: absolute;
    left: 50%;
    top: 50%;
    transform: translate(-50%, -50%);
    width: 4.5rem; /* 72px */
    height: 4.5rem;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s;
    box-shadow: 0 0 0 6px var(--color-bg-primary); /* Cutout effect */
  }

  /* Header Styles */
  .header-btn.active {
    background-color: var(--color-accent-primary);
    color: white;
  }
  .led-glow-special.active {
      background-color: rgba(250, 204, 21, 0.2);
      color: #facc15;
      animation: led-glow-special 1.5s infinite;
  }
  @keyframes led-glow-special {
      0%, 100% {
          box-shadow: 0 0 5px 2px rgba(250, 204, 21, 0.3), inset 0 0 3px 1px rgba(250, 204, 21, 0.2);
      }
      50% {
          box-shadow: 0 0 10px 3px rgba(250, 204, 21, 0.5), inset 0 0 5px 2px rgba(250, 204, 21, 0.4);
      }
  }

  /* Magazine Report Styles */
  .magazine-report {
    max-width: 800px;
    margin: 0 auto;
    transition: font-size 0.3s ease;
  }

  .magazine-report h1 {
    font-size: 2.5em; /* Use em for scalability */
    font-weight: 700;
    line-height: 1.2;
    border-bottom: 2px solid var(--color-border-primary);
    padding-bottom: 0.5em;
    margin-bottom: 1em;
  }

  .magazine-report .main-summary {
    font-size: 1.1em;
    line-height: 1.8;
    color: var(--color-text-muted);
    margin-bottom: 2em;
  }

  .magazine-report .main-summary::first-letter {
    font-size: 4em;
    font-weight: bold;
    float: left;
    line-height: 0.8;
    margin-right: 0.1em;
    color: var(--color-accent-secondary);
  }

  .magazine-report .main-image {
    width: 100%;
    border-radius: 0.75rem;
    margin-bottom: 1.5em;
  }

  .magazine-report blockquote {
    border-left: 4px solid var(--color-accent-primary);
    padding-left: 1rem;
    margin: 1.5em 0;
    font-style: italic;
    color: var(--color-text-muted);
  }

  .magazine-section {
    margin-bottom: 3em;
    display: flex;
    flex-direction: column;
    gap: 1.5em;
  }

  .magazine-section h2 {
    font-size: 1.75em;
    font-weight: 600;
    margin-bottom: 0.75em;
    padding-bottom: 0.5em;
    border-bottom: 1px solid var(--color-border-secondary);
  }

  .magazine-section-media {
    flex-shrink: 0;
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }

  .magazine-section-media img,
  .magazine-section-media iframe {
    width: 100%;
    border-radius: 0.5rem;
    border: 1px solid var(--color-border-primary);
  }

  .magazine-video-embed-container {
    position: relative;
    width: 100%;
    padding-bottom: 56.25%; /* 16:9 aspect ratio */
    height: 0;
  }
  .magazine-video-embed-container iframe {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
  }

  .magazine-podcast-player {
    border: 1px solid var(--color-border-primary);
    border-radius: 0.5rem;
    padding: 0.75rem;
    background-color: var(--color-bg-tertiary);
  }
  .magazine-podcast-player audio {
    filter: invert(0.9) hue-rotate(180deg);
  }

  /* Responsive layouts for sections */
  @media (min-width: 768px) {
    .magazine-section {
      flex-direction: row;
    }
    .magazine-section.layout-image-right {
      flex-direction: row-reverse;
    }
    .magazine-section-text {
      flex: 3;
    }
    .magazine-section-media {
      flex: 2;
    }
  }
  
  /* SERP API Panel Result Card */
  .serp-result-card {
    background: var(--color-bg-tertiary);
    border: 1px solid var(--color-border-primary);
    border-radius: 1rem;
    padding: 1.5rem;
    margin-bottom: 1.5rem;
  }
  .serp-result-card h3 {
    font-size: 1.5rem;
    font-weight: bold;
    color: var(--color-accent-secondary);
    margin-bottom: 0.75rem;
  }
  .serp-result-card .summary {
    font-size: 1rem;
    color: var(--color-text-muted);
    line-height: 1.6;
    margin-bottom: 1.5rem;
  }
  .serp-result-card .resource-list-item {
    display: flex;
    align-items: center;
    padding: 0.75rem;
    border-radius: 0.5rem;
    transition: background-color 0.2s;
  }
   .serp-result-card .resource-list-item:hover {
    background-color: var(--color-border-primary);
   }

  /* Custom MapLibre popup */
  .custom-map-popup .maplibregl-popup-content {
    background: var(--color-bg-tertiary);
    color: var(--color-text-base);
    padding: 0;
    border-radius: 8px;
    border: 1px solid var(--color-border-primary);
    box-shadow: 0 4px 12px rgba(0,0,0,0.4);
  }
  .custom-map-popup .maplibregl-popup-tip {
    border-top-color: var(--color-border-primary);
  }
  .custom-map-popup .maplibregl-popup-close-button {
      color: var(--color-text-muted);
  }
   .custom-map-popup .maplibregl-popup-close-button:hover {
      background-color: var(--color-border-primary);
  }

  /* Spreadsheet Panel Theming */
  .spreadsheet-panel-dark {
    --sp-bg-primary: rgba(13, 17, 23, 0.95);
    --sp-bg-secondary: #161B22;
    --sp-bg-tertiary: #21262D;
    --sp-bg-hover: #30363D;
    --sp-bg-selected: #1E40AF;
    --sp-text-primary: #E6EDF3;
    --sp-text-secondary: #8B949E;
    --sp-border-primary: #30363D;
    --sp-border-secondary: #484F58;
  }

  .spreadsheet-panel-light {
    --sp-bg-primary: #ffffff;
    --sp-bg-secondary: #f9fafb; /* gray-50 */
    --sp-bg-tertiary: #f3f4f6; /* gray-100 */
    --sp-bg-hover: #e5e7eb; /* gray-200 */
    --sp-bg-selected: #dbeafe; /* blue-100 */
    --sp-text-primary: #111827; /* gray-900 */
    --sp-text-secondary: #4b5563; /* gray-600 */
    --sp-border-primary: #d1d5db; /* gray-300 */
    --sp-border-secondary: #9ca3af; /* gray-400 */
  }

  /* Forro Calculator */
  .room-dimension-input-wrapper {
    position: relative;
    width: 200px;
    height: 150px;
    margin: 1rem auto;
    margin-top: 3rem;
    margin-bottom: 3rem;
  }
  .room-schematic {
    width: 100%;
    height: 100%;
    border: 2px solid var(--color-border-secondary);
    background-color: var(--color-bg-tertiary);
    border-radius: 0.25rem;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.875rem;
    color: var(--color-text-dim);
  }
  .room-dimension-input {
    position: absolute;
    background-color: var(--color-bg-secondary);
    border: 1px solid var(--color-border-primary);
    color: var(--color-text-base);
    width: 100px;
    padding: 0.25rem;
    text-align: center;
    border-radius: 0.25rem;
  }
  .room-dimension-input.width {
    top: 50%;
    left: -110px;
    transform: translateY(-50%);
  }
  .room-dimension-input.length {
    bottom: -40px;
    left: 50%;
    transform: translateX(-50%);
  }
  .ceiling-type-card {
    transition: all 0.2s;
  }
  .ceiling-type-card.selected {
    transform: scale(1.05);
    background-color: var(--color-accent-primary);
    border-color: var(--color-accent-secondary);
    color: white;
    box-shadow: 0 0 15px 3px var(--color-accent-glow);
  }
   .ceiling-type-card.selected .text-gray-400 {
     color: #bfdbfe; /* blue-200 */
   }
  .result-card {
    background-color: var(--color-bg-tertiary);
    border-left: 4px solid var(--color-accent-primary);
    padding: 1rem;
    border-radius: 0.5rem;
    margin-top: 1.5rem;
  }
  .result-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.75rem 0;
    border-bottom: 1px solid var(--color-border-primary);
  }
  .result-item:last-child {
    border-bottom: none;
  }

</style>
<link rel="stylesheet" href="/index.css">
</head>
<body>
  <div id="root"></div>
  <script type="module" src="/index.tsx"></script>
</body>
</html>